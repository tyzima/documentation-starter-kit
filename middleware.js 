import { NextResponse } from 'next/server';

export function middleware(request) {
  const password = process.env.SITE_PASSWORD;
  const { cookies, nextUrl } = request;

  // Check if the password is correct
  if (cookies.get('site-password') === password) {
    return NextResponse.next(); // Password is correct, allow the request
  }

  const submittedPassword = nextUrl.searchParams.get('password');

  if (submittedPassword === password) {
    const response = NextResponse.next();
    response.cookies.set('site-password', password, { maxAge: 60 * 60 * 24 });
    return response;
  }

  // If the password is not submitted or incorrect, show the password prompt
  return new NextResponse(
    `<html>
      <body>
        <form method="get" action="${nextUrl.pathname}">
          <label>Password:</label>
          <input type="password" name="password" />
          <button type="submit">Submit</button>
        </form>
      </body>
    </html>`,
    {
      headers: { 'Content-Type': 'text/html' },
    }
  );
}
